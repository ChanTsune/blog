---
title: "[c/c++] 実行時にバイトオーダを調べる"
date: 2019-05-30T02:10:50+00:00
lastmod: 2019-05-30T02:10:50+00:00
draft: false
categories: []
tags: ["c/c++"]
# weight: 2360
---
バイトオーダーを考慮してプログラムを組む必要があるときに超お手軽にバイトオーダーを判定する関数の作り方  

```c
#include <stdio.h>

int islittle(void)
{
    unsigned i = 1;
    return *((char *)&i);
}

int main(int argc, char const *argv[])
{
    if (islittle())
    {
        printf("little endian\n");
    }
    else
    {
        printf("big endian\n");
    }
}


```
原理は以下の通りです。  
`unsigned`を4バイトと仮定して`1`で初期化した場合メモリ上のデータの配置が
リトルエンディアンなら

|番地|0|1|2|3|
|---|---|---|---|---|
|値|0x1|0x0|0x0|0x0|

ビッグエンディアンなら

|番地|0|1|2|3|
|---|---|---|---|---|
|値|0x0|0x0|0x0|0x1|

となります。  

アドレスを取得すると先頭アドレスは表の`0`番地を指します。  

そのアドレスを1バイトの`char`のポインタにキャストします。  

すると`char`ポインタの実体は、リトルエンディアンなら`1`、ビッグエンディアンなら`0`を示すようになります。
なので実行時にバイトオーダーが判別できるというわけです。
